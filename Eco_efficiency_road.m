data = [22026	547.44	279180	6368.507	117.67	161.32	462.04
16764	273.69	57471	5846.28	78.39	372.49	424.22
188431	1245.89	148054	23095.1	244.18	7294.59	1675.96
142066	526.39	83031	20640.23	141.14	1452.06	1497.59
196061	418.53	69790	13555.6	152.75	2423.64	983.01
120613	659.41	122195	38467.18	306.70	2936.76	2790.56
102484	352.93	52935	9689.467	168.72	1084.77	703.13
164502	394.19	72898	14830.52	200.10	904.76	1075.22
13292	322.87	196395	14701.42	114.98	281.98	1066.39
157304	1427.91	259038	44574.38	779.98	2140.33	3232.53
119053	1257.35	165609	29855.04	465.12	1626.78	2165.02
197588	600.81	128272	25006.76	491.27	4915.71	1814.12
106757	493.64	104685	20907.2	251.95	1094.70	1516.44
161909	399.29	103024	19004.86	282.34	3147.50	1378.85
265720	1723.34	224205	41850.96	472.40	6071.43	3037.09
267441	1104.47	254487	29521.48	760.57	4838.53	2141.68
260179	588.69	166210	38351.19	487.33	2506.86	2781.58
238273	595.8	102405	29073.15	577.03	2686.57	2109.31
218085	1674.64	393904	67425.42	1079.80	3381.92	4891.51
120547	424.9	75405	22479.4	390.05	2248.46	1630.72
28217	96.32	21705	2503.397	75.36	76.11	181.62
142921	327.47	172431	20206.28	336.75	935.45	1466.38
324138	880.8	191317	23184.69	597.84	1565.31	1681.45
191626	348.7	55171	19955.83	443.10	873.23	1447.60
238052	552.05	79584	24971.36	319.99	1173.06	1811.84
172471	491.23	115492	14995.89	290.80	1925.83	1087.98
143039	277.25	48593	10681.42	253.26	949.64	775.06
78585	88.65	16308	4019.001	47.50	236.04	291.68
33940	115.34	11387	4226.243	64.42	577.56	306.72
182085	327.06	79460	21211.53	213.47	1102.21	1539.02
];

Y_g = data(:,5:6);
X = data(:,1:4);
Y_b = data(:,7);

[n m]=size(X);
[n s]=size(Y_g);
[n p]=size(Y_b);

for i=1:n
    Aeq=[zeros(1,s) X(i,:) zeros(1,s) Y_b(i,:)];
    beq=1;
    f=-[Y_g(i,:) zeros(1,m) zeros(1,s) zeros(1,p)];
    A1=[zeros(n,s) -X Y_g zeros(n,p)];
    A2=[Y_g zeros(n,m) -Y_g -Y_b];
    A3=[-0.9*eye(s) zeros(s,m) eye(s) zeros(s,p)];
    A4=[0.5*eye(s) zeros(s,m) -eye(s) zeros(s,p)];
    A=[A1;A2;A3;A4];
    b=zeros(2*n+s+s,1);
    LB=[zeros(1,s+m+s+p)]';   
    w(:,i)=linprog(f,A,b,Aeq,beq,LB);
    e(i,1)=-f*w(:,i);
    
end


for i=1:n
    Aeq1=[zeros(1,s) X(i,:) zeros(1,s) zeros(1,p)];
    Aeq2=[Y_g(i,:) -e(i,1)*X(i,:) zeros(1,s) -e(i,1)*Y_b(i,:)];
    Aeq=[Aeq1;Aeq2];
    beq=[1;0];
    f=-[zeros(1,s) zeros(1,m) Y_g(i,:) zeros(1,p)];
    A1=[zeros(n,s) -X Y_g zeros(n,p)];
    A2=[Y_g zeros(n,m) -Y_g -Y_b];
    A3=[-0.9*eye(s) zeros(s,m) eye(s) zeros(s,p)];
    A4=[0.5*eye(s) zeros(s,m) -eye(s) zeros(s,p)];
    A=[A1;A2;A3;A4];
    b=zeros(2*n+s+s,1);
    LB=[zeros(1,s+m+s+p)]';   
    w(:,i)=linprog(f,A,b,Aeq,beq,LB);
    e1(i,1)=-f*w(:,i);
    

end
alpha1 = (w(m+1:m+s,:)./w(1:s,:))';

for i=1:n
    Aeq1=[zeros(1,s) zeros(1,m) zeros(1,s) Y_b(i,:)];
    Aeq2=[Y_g(i,:) -e(i,1)*X(i,:) zeros(1,s) -e(i,1)*Y_b(i,:)];
    Aeq=[Aeq1;Aeq2];
    beq=[1;0];
    f=-[Y_g(i,:) zeros(1,m) -Y_g(i,:) zeros(1,p)];
    A1=[zeros(n,s) -X Y_g zeros(n,p)];
    A2=[Y_g zeros(n,m) -Y_g -Y_b];
    A3=[-0.9*eye(s) zeros(s,m) eye(s) zeros(s,p)];
    A4=[0.5*eye(s) zeros(s,m) -eye(s) zeros(s,p)];
    A=[A1;A2;A3;A4];
    b=zeros(2*n+s+s,1);
    LB=[zeros(1,s+m+s+p)]';   
    w(:,i)=linprog(f,A,b,Aeq,beq,LB);
    e2(i,1)=-f*w(:,i);
    ui = w(1:s,i);
    pi = w(s+m+1:s+m+s,i);
    lambda1(i,1) = (Y_g(i,:)*pi)/(Y_g(i,:)*ui);
    lambda2(i,1) = 1 - lambda1(i,1);

end
alpha2 = (w(m+1:m+s,:)./w(1:s,:))';

E = 1./e;
E2 = 1./e2;
E2_1 = (E-E2.*lambda2)./lambda1;


e2_1 = 1./E2_1;


EE = [e e2_1 e2 lambda1 lambda2];

axis([0 1 0 1]);
hold on
scatter(e2_1,e2,'o');
    xlabel('Technical Efficiency')
    ylabel('Environmental Efficiency')
    hold on
    plot([0,1],[0.5,0.5],'color','k')
    hold on
    plot([0.5,0.5],[0,1],'color','k')
    hold on
    text(e2_1(9),e2(9),'  SH','color','k')
    text(e2_1(4),e2(4),'  SX','color','k')
    text(e2_1(3),e2(3),'  HB','color','k')



